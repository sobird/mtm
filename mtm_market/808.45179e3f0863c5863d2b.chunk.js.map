{"version":3,"file":"808.45179e3f0863c5863d2b.chunk.js","mappings":"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","sources":["webpack:///./src/components/search-form/index.tsx","webpack:///./src/hooks/useSearchParamsState.ts","webpack:///./src/components/table/index.tsx","webpack:///./src/pages/coupon/components/create-coupon-button/index.tsx","webpack:///./src/pages/coupon/index.tsx","webpack:///./src/services/coupon.ts"],"sourcesContent":["/**\n * 高级搜索表单\n *\n * sobird<i@sobird.me> at 2023/10/05 20:48:29 created.\n */\nimport React, { useEffect, PropsWithChildren } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport { Button, Form, FormProps } from 'antd';\n\ninterface SearchFormProps<Values> extends FormProps {\n  beforeInitialValues?: (val: URLSearchParams) => URLSearchParams;\n  beforeValuesChange?: (val: Values) => Values;\n  reset?: boolean;\n  submit?: boolean;\n}\n\nconst SearchForm: React.FC<PropsWithChildren<SearchFormProps<any>>> = ({\n  beforeValuesChange,\n  beforeInitialValues,\n  children,\n  reset,\n  submit,\n  ...props\n}) => {\n  const [form] = Form.useForm();\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  // 初始化表单值\n  useEffect(() => {\n    const newURLSearch = beforeInitialValues?.(searchParams) ?? searchParams;\n    form.setFieldsValue(Object.fromEntries(newURLSearch.entries()));\n  }, []);\n\n  const onValuesChange = changedValues => {\n    const newValues = beforeValuesChange?.(changedValues) ?? changedValues;\n\n    setTimeout(() => {\n      setSearchParams(prev => {\n        return {\n          ...Object.fromEntries(prev.entries()),\n          ...newValues,\n        };\n      });\n    }, 100);\n  };\n\n  if(!submit) {\n    props.onValuesChange = onValuesChange;\n  }\n\n  return (\n    <Form layout='inline' form={form} onFinish={(values) => onValuesChange(values)} {...props}>\n      {children}\n      {submit ? (\n        <Form.Item>\n          <Button type='primary' htmlType='submit'>\n            查询\n          </Button>\n        </Form.Item>\n      ) : null}\n      {reset ? (\n        <Form.Item>\n          <Button\n            onClick={() => {\n              form.resetFields();\n              onValuesChange(form.getFieldsValue());\n            }}\n          >\n            重置\n          </Button>\n        </Form.Item>\n      ) : null}\n    </Form>\n  );\n};\n\nexport default SearchForm;\n","/**\n * useSearchParamsState Hook\n *\n * sobird<i@sobird.me> at 2023/10/05 10:13:44 created.\n */\n\nimport { useEffect } from 'react';\nimport { useSearchParams } from 'react-router-dom';\n\nlet singletonSearchParams = null;\n\nexport default function useSearchParamsState(\n  searchParamName: string,\n  defaultValue: string\n): readonly [searchParamsState: string, setSearchParamsState: (newState: string) => void] {\n  const [searchParams, setSearchParams] = useSearchParams();\n  const acquiredSearchParam = searchParams.get(searchParamName);\n  const searchParamsState = acquiredSearchParam ?? defaultValue;\n\n  useEffect(() => {\n    singletonSearchParams = searchParams;\n  }, [searchParams.toString()]);\n\n  const setSearchParamsState = (newState: string) => {\n    singletonSearchParams.set(searchParamName, newState);\n    setTimeout(() => {\n      setSearchParams(singletonSearchParams);\n    }, 0);\n  };\n\n  return [searchParamsState, setSearchParamsState];\n}\n","/**\n * 表格\n *\n * sobird<i@sobird.me> at 2023/10/05 23:50:18 created.\n */\n\nimport React, { ComponentProps } from 'react';\nimport { Table } from 'antd';\nimport useSearchParamsState from '@/hooks/useSearchParamsState';\n\nconst MTable: React.FC<ComponentProps<typeof Table>> = ({ children, pagination, ...props }) => {\n  const [searchParamPn, setSearchParamPn] = useSearchParamsState('pn', '1');\n  const [searchParamPs, setSearchParamPs] = useSearchParamsState('ps', '20');\n\n  return (\n    <Table\n      bordered\n      rowKey='id'\n      scroll={{ x: 1400 }}\n      size='middle'\n      pagination={{\n        position: ['bottomCenter'],\n        current: Number(searchParamPn),\n        pageSize: Number(searchParamPs),\n        showSizeChanger: true,\n        onChange: (page, pageSize) => {\n          setSearchParamPn(String(page));\n          setSearchParamPs(String(pageSize));\n        },\n        ...pagination,\n      }}\n      {...props}\n    >\n      {children}\n    </Table>\n  );\n};\n\nexport default MTable;\n","/**\n * 创建优惠券按钮组件\n *\n * sobird<i@sobird.me> at 2023/10/06 10:14:08 created.\n */\n\nimport React, { useState, PropsWithChildren, ComponentProps } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport classnames from 'classnames';\nimport { Button, Modal } from 'antd';\nimport { ECouponTarget } from '@/services/coupon';\n\nimport IconCouponTarget1 from './images/coupon_target_1.png';\nimport IconCouponTarget2 from './images/coupon_target_2.png';\nimport IconCouponTarget3 from './images/coupon_target_3.png';\n\nimport './index.scss';\n\n\nconst CreateCouponButton: React.FC<PropsWithChildren<ComponentProps<typeof Button>>> = ({ children, ...props}) => {\n  const [open, setOpen] = useState(false);\n  const [couponTarget, setCouponTarget] = useState(0);\n  const navigate = useNavigate();\n\n  return (\n    <>\n      <Button {...props} onClick={() => setOpen(true)}>{children}</Button>\n      <Modal\n        title='请选择券类型'\n        cancelText='取消'\n        okText='下一步'\n        open={open}\n        onCancel={() => setOpen(false)}\n        onOk={() => {\n          setOpen(false);\n          navigate(`/coupon/create?target=${couponTarget}`);\n        }}\n        closable\n        okButtonProps={{ disabled: couponTarget === 0 }}\n        transitionName=\"\"\n        maskTransitionName=\"\"\n      >\n        <div\n          className={classnames('coupon-target-item', {\n            'coupon-target-active': couponTarget === ECouponTarget.店铺商品券,\n          })}\n          onClick={() => {\n            setCouponTarget(ECouponTarget.店铺商品券);\n          }}\n        >\n          <div className='target-icon'>\n            <img src={IconCouponTarget1} />\n          </div>\n          <div className='target-text'>\n            <h4>店铺商品券</h4>\n            <p>发放店铺商品促销优惠券，提升商品转化，带动商品销量，用户可在商详页、IM等渠道领券后使用</p>\n          </div>\n\n          <div className='sup-mark' />\n        </div>\n\n        <div\n          className={classnames('coupon-target-item', {\n            'coupon-target-active': couponTarget === ECouponTarget.店铺通用券,\n          })}\n          onClick={() => {\n            setCouponTarget(ECouponTarget.店铺通用券);\n          }}\n        >\n          <div className='target-icon'>\n            <img src={IconCouponTarget2} />\n          </div>\n          <div className='target-text'>\n            <h4>店铺通用券</h4>\n            <p>发放店铺通用优惠券，提升店铺整体转化效果，用户可在商详页等渠道领取后使用</p>\n          </div>\n          <div className='sup-mark' />\n        </div>\n\n        <div\n          className={classnames('coupon-target-item', {\n            'coupon-target-active': couponTarget === ECouponTarget.店铺客服体验券,\n          })}\n          onClick={() => {\n            setCouponTarget(ECouponTarget.店铺客服体验券);\n          }}\n        >\n          <div className='target-icon'>\n            <img src={IconCouponTarget3} />\n          </div>\n          <div className='target-text'>\n            <h4>店铺客服体验券</h4>\n            <p>发放用户安慰、赔付、奖励优惠券，提升用户服务体验，强化客户关系，用户可在IM客服渠道领券后使用</p>\n          </div>\n          <div className='sup-mark' />\n        </div>\n      </Modal>\n    </>\n  );\n};\n\nexport default CreateCouponButton;\n","/**\n * 商家端优惠券列表\n *\n * sobird<i@sobird.me> at 2023/09/15 21:14:09 created.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { Button, Table, Tag, Popconfirm, Space, Form, TimeRangePickerProps, DatePicker, Radio, Row, Col } from 'antd';\nimport { Link, useLocation } from 'react-router-dom';\nimport dayjs from 'dayjs';\n\nimport CouponService, {\n  ICouponEntity,\n  ICouponPagination,\n  ECouponType,\n  ECouponTarget,\n  ECouponStatus,\n  ECouponStatusColor,\n  CouponStatusOption,\n} from '@/services/coupon';\nimport SearchForm from '@/components/search-form';\nimport MTable from '@/components/table';\nimport CreateCouponButton from './components/create-coupon-button';\n\nconst { Column } = Table;\nconst { RangePicker } = DatePicker;\nimport './index.scss';\n\nconst rangePresets: TimeRangePickerProps['presets'] = [\n  { label: '最近一周', value: [dayjs().add(-7, 'd'), dayjs()] },\n  { label: '最近两周', value: [dayjs().add(-14, 'd'), dayjs()] },\n  { label: '最近一个月', value: [dayjs().add(-1, 'month'), dayjs()] },\n];\n\nconst Coupons: React.FC = () => {\n  const location = useLocation();\n  const [couponPagination, setCouponPagination] = useState<ICouponPagination>();\n\n  useEffect(() => {\n    CouponService.list().then(res => {\n      setCouponPagination(res);\n    });\n  }, [location.search]);\n  return (\n    <div className='page-coupons'>\n      <MTable\n        bordered\n        title={() => {\n          return (\n            <Row>\n              <Col flex={1}>\n                <SearchForm reset submit>\n                  <Form.Item\n                    name='status'\n                    getValueProps={value => {\n                      return {\n                        // 数据类型转换\n                        value: Number.isInteger(Number(value)) ? Number(value) : -1,\n                      };\n                    }}\n                  >\n                    <Radio.Group\n                      defaultValue={-1}\n                      buttonStyle='solid'\n                      options={CouponStatusOption}\n                      optionType='button'\n                    />\n                  </Form.Item>\n                  <Form.Item\n                    name='term'\n                    getValueFromEvent={(...[, dateString]) => {\n                      return JSON.stringify(dateString);\n                    }}\n                    getValueProps={value => {\n                      let objValue = [];\n                      try {\n                        objValue = JSON.parse(value);\n                      } catch (err) {\n                        objValue = [];\n                      }\n                      return {\n                        value: objValue\n                          ? objValue.map(item => {\n                              return dayjs(item).isValid() ? dayjs(item) : undefined;\n                            })\n                          : undefined,\n                      };\n                    }}\n                  >\n                    <RangePicker\n                      placeholder={['券发放开始时间', '券发放结束时间']}\n                      showTime\n                      format='YYYY-MM-DD HH:mm:ss'\n                      presets={rangePresets}\n                    />\n                  </Form.Item>\n                </SearchForm>\n              </Col>\n              <Col>\n                <CreateCouponButton type='primary'>创建券</CreateCouponButton>\n              </Col>\n            </Row>\n          );\n        }}\n        dataSource={couponPagination?.list}\n        rowKey='id'\n        scroll={{ x: 1400 }}\n        size='middle'\n        pagination={{\n          total: couponPagination?.total,\n        }}\n        // footer={() => {\n        //   return (\n        //     <div>dddd</div>\n        //   )\n        // }}\n      >\n        <Column title='优惠券编码' dataIndex='id' width={120} />\n        <Column<ICouponEntity>\n          title='优惠券名称'\n          dataIndex='name'\n          render={(text, record) => {\n            return <Link to={`/coupons/${record.id}`}>{text}</Link>;\n          }}\n        />\n        <Column\n          title='优惠类型'\n          dataIndex='type'\n          width={100}\n          render={text => {\n            return ECouponType[text];\n          }}\n        />\n        <Column\n          title='券类型'\n          dataIndex='target'\n          width={130}\n          render={text => {\n            return ECouponTarget[text];\n          }}\n        />\n        <Column title='发放时间' width={120} dataIndex='stime' />\n        <Column title='使用时间' width={150} dataIndex='validDays' />\n        <Column title='发放数量' width={100} dataIndex='sendCount' />\n        <Column title='当前余量' width={100} dataIndex='leftCount' />\n        <Column title='创建时间' dataIndex='ctime' width={120} />\n        <Column\n          title='状态'\n          dataIndex='status'\n          fixed='right'\n          width={80}\n          render={text => {\n            return <Tag color={ECouponStatusColor[text]}>{ECouponStatus[text]}</Tag>;\n          }}\n        />\n        <Column<ICouponEntity>\n          title='操作'\n          dataIndex='status'\n          fixed='right'\n          width={150}\n          render={(text, record) => {\n            return (\n              <Space>\n                <Link to={`/coupons/${record.id}`}>查看</Link>\n                {text < 2 && (\n                  <Button type='link' style={{ padding: 0 }}>\n                    编辑\n                  </Button>\n                )}\n                {text < 2 && (\n                  <Popconfirm\n                    title='您确定要下线该优惠券吗？'\n                    onConfirm={() => {\n                      CouponService.delete(record.id);\n                    }}\n                    okText='确定'\n                    cancelText='取消'\n                  >\n                    <Button type='link' style={{ padding: 0 }}>\n                      下线\n                    </Button>\n                  </Popconfirm>\n                )}\n              </Space>\n            );\n          }}\n        />\n      </MTable>\n    </div>\n  );\n};\n\nexport default Coupons;\n","/**\n * 优惠券服务\n * \n * sobird<i@sobird.me> at 2023/09/15 21:58:06 created.\n */\n\nimport http from \"@mtm/shared/utils/http\";\n\ninterface ISpu {\n  /** SPU ID */\n  id: number;\n  /** SPU名称 */\n  name: string;\n  /** SPU状态; 0:已下架, 1:已上架 */\n  status: number;\n  /** 库存 */\n  stock: number;\n  /** 最低价 */\n  minPrice: number;\n  /** 当前SPU下的SKU数量 */\n  skuCount: number;\n}\n\nexport interface ICouponEntity {\n  /** 优惠券ID */\n  id: number;\n  /** 优惠券名称 */\n  name: string;\n  /** 优惠券文案 */\n  displayName: string;\n  /** 优惠券类型; 0:满减券, 1:折扣券 */\n  type: 0 | 1;\n  /** 发放时间段 */\n  putTerm: {\n    /** 优惠券发放开始日期 */\n    stime: number;\n    /** 优惠券发放结束日期 */\n    etime: number;\n  },\n  amountRule: {\n    amount: number;\n    discount: number;\n  },\n  /** 优惠券库存 */\n  stock: number;\n  /** 优惠券门槛 单位: 元 */\n  price: number;\n  /** 优惠券面额 单位: 元 */\n  discount: number;\n  /** 每人限领张数 */\n  limitCount: number;\n  /** \n   * 使用期限 单位: 天\n   * \n   * 先判断useTerm[0]的值，该值 >0 认为 是券领取X天内有效;\n   * 该值<=0 或 false，认为是在useTerm[1]到useTerm[2]期间券可以进行使用\n   */\n  useTerm: {\n    /** 优惠券领取X天内有效 */\n    periodDay: number;\n    stime: number;\n    etime: number;\n  };\n  /** 发券目标 */\n  target: 11 | 12;\n  /** 投放目标人群 -1:全部用户 新老客, 1:老客, 2:新老客 */\n  putTarget: -1 | 1 | 2;\n  /** 使用人群 */\n  useTarget: -1 | 1 | 2;\n  /** 投放位置 */\n  position: number;\n  /** 使用范围 */\n  useScope: string;\n  /** 发放数量 */\n  sendCount: number;\n  /** 当前余量 */\n  leftCount: number;\n  /** 优惠券状态; 未开始:0, 已开始(进行中):1, 已结束:2, 已撤销(已下线):6 */\n  status: 0 | 1 | 2 | 6;\n  /** 创建时间 时间戳 */\n  ctime: number;\n  /** 优惠券商品列表 */\n  spuList: ISpu[];\n  /** SPU ID 列表 */\n  spuIds: [];\n  /** 商家ID列表 */\n  wmPoiIds: number[]\n}\n\nexport interface ICouponPagination {\n  ps?: number;\n  pn?: number;\n  total: number;\n  list: ICouponEntity[]\n}\n\nexport enum ECouponType {\n  \"满减券\" = 0,\n  \"折扣券\" = 1\n}\n\nexport enum ECouponTarget {\n  \"店铺商品券\" = 1,\n  \"店铺通用券\" = 2,\n  \"店铺客服体验券\" = 3\n}\n\nexport enum ECouponStatus {\n  \"全部\" = -1,\n  \"未开始\" = 0,\n  \"进行中\" = 1,\n  \"已结束\" = 2,\n  \"已下线\" = 6\n}\n\nexport const CouponStatusOption = [\n  { value: -1, label: \"全部\"},\n  { value: 0, label: \"未开始\"},\n  { value: 1, label: \"进行中\"},\n  { value: 2, label: \"已结束\"},\n  { value: 6, label: \"已下线\"}\n];\n\nexport enum ECouponStatusColor {\n  \"gray\" = 0,\n  \"green\" = 1,\n  \"blue\" = 2,\n  \"red\" = 6\n}\n\nexport interface ICouponsParams {\n  ps?: number;\n  pn?: number;\n  status?: number;\n  stime?: number;\n  etime?: number;\n}\n\nconst CouponService = {\n  list(params?: ICouponsParams) {\n    return http.get<ICouponPagination>('/merchant/coupons', params);\n  },\n  detail(id: number) {\n    return http.get<ICouponEntity>('/merchant/coupons', { id });\n  },\n  delete(id: number) {\n    return http.delete<ICouponEntity>('/merchant/coupons', { id });\n  },\n  create(data: ICouponEntity) {\n    return http.post<ICouponEntity>('/merchant/coupons', data);\n  },\n  update(data: ICouponEntity) {\n    return http.patch<ICouponEntity>('/merchant/coupons', data);\n  }\n}\n\nexport default CouponService;\n"],"names":["beforeValuesChange","beforeInitialValues","children","reset","submit","props","form","searchParams","setSearchParams","newURLSearch","onValuesChange","changedValues","newValues","prev","values","singletonSearchParams","useSearchParamsState","searchParamName","defaultValue","acquiredSearchParam","searchParamsState","newState","pagination","searchParamPn","setSearchParamPn","searchParamPs","setSearchParamPs","page","pageSize","open","setOpen","couponTarget","setCouponTarget","navigate","Column","RangePicker","rangePresets","location","couponPagination","setCouponPagination","res","value","dateString","objValue","item","text","record","ECouponType","ECouponTarget","ECouponStatus","CouponStatusOption","ECouponStatusColor","params","id","data"],"sourceRoot":""}